# bil-python

## 🐍 Определение языка Python

**Python** — это высокоуровневый, интерпретируемый, динамически типизированный язык программирования с автоматическим управлением памятью.  
Он сочетает простоту синтаксиса с мощными возможностями для работы с данными, объектно-ориентированным и функциональным стилями программирования.  
Основная реализация — **CPython**, написанная на C. Именно она выполняет байткод Python, управляет памятью и содержит глобальную блокировку интерпретатора (GIL).

---

## Интерпретатор

Python работает как интерпретатор с компиляцией в байткод, выполняемый виртуальной машиной.
Процесс включает:
* токенизацию → построение AST → компиляцию в байткод → выполнение байткода,
* управление памятью через счетчик ссылок и сборщик мусора,
* обработку ошибок, стековые фреймы для функций и глобальную блокировку GIL для потоков.

| №  | Этап                              | Описание |
|----|-----------------------------------|-----------|
| 1  | Чтение исходного кода             | Интерпретатор открывает `.py` файл, читает текст в кодировке UTF-8. |
| 2  | Лексический анализ (tokenize)     | Исходный текст разбивается на токены: ключевые слова, идентификаторы, литералы, отступы, операторы. |
| 3  | Синтаксический анализ (AST)       | Из токенов строится абстрактное синтаксическое дерево (AST), где описана структура кода. |
| 4  | Проверки и оптимизация AST         | Выполняются проверки синтаксиса и простые оптимизации (например, объединение строк). |
| 5  | Компиляция в байткод              | AST компилируется в байткод (набор инструкций для виртуальной машины CPython). Создаются объекты `code`. |
| 6  | Кэширование байткода (.pyc)       | При импорте модулей байткод сохраняется в `__pycache__` для ускорения повторного запуска. |
| 7  | Импорт модулей                    | При `import` интерпретатор ищет модуль, компилирует и исполняет его, создавая запись в `sys.modules`. |
| 8  | Создание объектов и namespace     | Создаются глобальные области видимости (`globals`), функции, классы и их словари имён. |
| 9  | Исполнение байткода (VM)          | Виртуальная машина CPython (`PyEval_EvalFrameDefault`) выполняет инструкции байткода, используя стек. |
| 10 | Вызов функций и создание фреймов  | При вызове создаётся новый стековый фрейм с локальными переменными и ссылкой на `code object`. |
| 11 | Обработка исключений              | При ошибках создаются объекты исключений, ищутся блоки `try/except`, формируется traceback. |
| 12 | Управление памятью                | Используется счётчик ссылок (reference counting) и сборщик мусора для циклических ссылок. |
| 13 | GIL (Global Interpreter Lock)     | Глобальная блокировка, позволяющая исполняться только одному потоку Python-кода одновременно. |
| 14 | Работа с C-расширениями           | C-модули могут взаимодействовать с CPython API и при необходимости временно освобождать GIL. |
| 15 | Завершение работы интерпретатора  | Освобождаются ресурсы, вызываются `atexit`-функции, очищаются модули и память. |

---

```
          ┌─────────────────────────────┐
          │     Исходный код Python      │
          │        (файл .py)           │
          └──────────────┬─────────────┘
                         │
                         ▼
          ┌─────────────────────────────┐
          │      Чтение файла в строку  │
          └──────────────┬─────────────┘
                         │
                         ▼
          ┌─────────────────────────────┐
          │    Лексический анализ       │
          │      (токенизация)         │
          │  Ключевые слова, ID,       │
          │  числа, строки, операторы  │
          └──────────────┬─────────────┘
                         │
                         ▼
          ┌─────────────────────────────┐
          │  Синтаксический анализ      │
          │      (AST)                  │
          │  Дерево выражений и блоков  │
          └──────────────┬─────────────┘
                         │
                         ▼
          ┌─────────────────────────────┐
          │  Проверка и оптимизация AST │
          │  (скобки, порядок операций) │
          └──────────────┬─────────────┘
                         │
                         ▼
          ┌─────────────────────────────┐
          │ Компиляция AST в байткод     │
          │   (code object)             │
          └──────────────┬─────────────┘
                         │
                         ▼
          ┌─────────────────────────────┐
          │  Кэширование байткода (.pyc)│
          │  (для ускорения импорта)    │
          └──────────────┬─────────────┘
                         │
                         ▼
          ┌─────────────────────────────┐
          │ Импорт модулей              │
          │ (поиск, компиляция, exec)  │
          └──────────────┬─────────────┘
                         │
                         ▼
          ┌─────────────────────────────┐
          │ Создание объектов и namespace│
          │  Переменные, функции, классы│
          └──────────────┬─────────────┘
                         │
                         ▼
          ┌─────────────────────────────┐
          │ Исполнение байткода VM       │
          │  (PyEval_EvalFrameDefault)  │
          │  Стек, операции, выражения  │
          └──────────────┬─────────────┘
                         │
             ┌───────────┴───────────────┐
             │                           │
             ▼                           ▼
 ┌───────────────────────┐       ┌─────────────────────┐
 │ Вызов функций и фреймы │       │ Обработка исключений │
 │ Локальные переменные, │       │ try/except, traceback│
 │ стек вызовов           │       └─────────────────────┘
 └───────────────┬────────┘
                 │
                 ▼
       ┌─────────────────────┐
       │ Управление памятью  │
       │ Ref-count + GC      │
       └───────────────┬─────┘
                       │
                       ▼
             ┌───────────────────┐
             │ Завершение работы  │
             │ Освобождение ресурсов│
             └───────────────────┘
```

---

## Вопросы

| №  | Вопрос                                                                 | Ответ |
|----|------------------------------------------------------------------------|-------|
| 1  | Что такое Python и чем отличается его основная реализация CPython?     | Python — высокоуровневый, интерпретируемый, динамически типизированный язык. CPython — основная реализация на C, выполняет байткод, управляет памятью и содержит GIL. |
| 2  | Какие основные этапы выполнения Python-кода от файла до результата?    | Чтение кода → Токенизация → AST → Оптимизация AST → Компиляция в байткод → Кэширование (.pyc) → Импорт модулей → Создание объектов/namespace → Исполнение байткода → Вызов функций и фреймы → Исключения → Управление памятью → GIL → Завершение работы интерпретатора. |
| 3  | Для чего используется токенизация?                                      | Токенизация разбивает исходный код на отдельные элементы (токены): ключевые слова, идентификаторы, литералы, операторы, скобки. |
| 4  | Что такое AST и зачем оно нужно?                                        | AST — абстрактное синтаксическое дерево. Оно отражает структуру кода и используется для проверки синтаксиса, оптимизации и компиляции в байткод. |
| 5  | Как Python управляет памятью?                                           | Через счетчик ссылок (reference counting) и сборщик мусора для циклических ссылок. |
| 6  | Что такое GIL и зачем он нужен?                                         | GIL (Global Interpreter Lock) — глобальная блокировка, которая позволяет исполняться только одному потоку Python-кода одновременно, защищая внутренние структуры CPython. |
| 7  | Чем байткод отличается от исходного кода Python?                        | Байткод — промежуточное представление, набор инструкций для виртуальной машины Python, создаётся из AST и исполняется VM. |
| 8  | Что происходит при импорте модуля?                                      | Интерпретатор ищет файл модуля, компилирует в байткод, исполняет его, добавляет объект модуля в `sys.modules`, при необходимости сохраняет `.pyc`. |
| 9  | Как Python обрабатывает исключения?                                     | При ошибках создаются объекты исключений, ищутся блоки `try/except`, формируется traceback, управление передаётся обработчику. |
| 10 | Какие структуры данных используются при исполнении функций в Python?   | Стековый фрейм (Frame) с локальными переменными, ссылкой на глобальные переменные и `code object`. Стек внутри фрейма используется для вычислений. |
| 11 | Как Python кэширует байткод и зачем?                                     | Байткод сохраняется в `.pyc` в `__pycache__` для ускорения повторного запуска без повторной компиляции. |
